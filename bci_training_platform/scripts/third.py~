#!/usr/bin/env python
from __future__ import division
import rospy
import numpy as np
import scipy.signal as sg
from std_msgs.msg import Float64MultiArray

from threading import Thread as Th
import matplotlib.pyplot as plt
import matplotlib.animation as animation

fs=250
n_order=100
f1_2=[8,30]
b = sg.firwin(n_order,f1_2,pass_zero=False,window='blackman',nyq=fs/2) 


dados=[]
coisa=[]
flag=0
plot=0
def callback(dat):
    global dados,coisa,flag,pub3,plot
    print(len(dat.data))
    dados = sg.convolve(dat.data,b,mode='full')
    if flag==0:
        while plot==1:
            pass
	flag=1
        coisa=dados
        pub3.publish(data=coisa)
	flag=0

def third():
    global pub3
    rospy.init_node('third', anonymous=True)
    rospy.Subscriber('canal2', Float64MultiArray, callback,queue_size=1)
    pub3=rospy.Publisher('canal3', Float64MultiArray, queue_size=1)
    rate = rospy.Rate(4)
    ani = animation.FuncAnimation(fig, animate, interval=400)
    plt.show()
#    while not rospy.is_shutdown():
        #rospy.get_time()
#	coisa=dados
#        pub3.publish(data=coisa)
#	flag=0
#	rate.sleep()
    rospy.spin()
    

if __name__ == '__main__':
    third()







